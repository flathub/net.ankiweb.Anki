{
  "app-id": "net.ankiweb.Anki",
  "runtime": "org.kde.Platform",
  "runtime-version": "5.9",
  "sdk": "org.kde.Sdk",
  "command": "anki",
  "finish-args": [
    "--socket=x11",
    "--socket=pulseaudio",
    "--socket=wayland",
    "--share=network",
    "--share=ipc",
    "--device=dri"
  ],
  "rename-desktop-file": "anki.desktop",
  "rename-icon": "anki",
  "cleanup": [
    "/bin/chardetect",
    "/bin/markdown_py"
  ],
  "modules": [
    {
      "name": "pyqt5",
      "sources": [
        {
          "type": "archive",
          "url": "https://sourceforge.net/projects/pyqt/files/PyQt5/PyQt-5.9.2/PyQt5_gpl-5.9.2.tar.gz",
          "sha256": "c190dac598c97b0113ca5e7a37c71c623f02d1d713088addfacac4acfa4b8394"
        },
        {
          "type": "script",
          "dest-filename": "configure",
          "commands": [
            "#!/bin/sh",
            "/usr/bin/python3 configure.py \\",
            "  --assume-shared \\",
            "  --confirm-license \\",
            "  --no-designer-plugin \\",
            "  --no-qml-plugin \\",
            "  --sysroot=/app \\",
            "  --sip=/app/bin/sip \\",
            "  --sip-incdir=/app/include \\",
            "  --no-qsci-api \\",
            "  --no-stubs \\",
            "  --no-tools \\",
            "  --no-docstrings \\",
            "  QMAKE_CFLAGS_RELEASE='-I/usr/include/python3.5m/' \\",
            "  QMAKE_CXXFLAGS_RELEASE='-I/usr/include/python3.5m/'"
          ]
        }
      ],
      "modules": [
        {
          "name": "sip",
          "sources": [
            {
              "type": "archive",
              "url": "https://sourceforge.net/projects/pyqt/files/sip/sip-4.19.7/sip-4.19.7.tar.gz",
              "sha256": "25b50d29dd4b72965e7980c41e3320e460eff481a177beeddebf8c3be84b8cde"
            },
            {
              "type": "script",
              "dest-filename": "configure",
              "commands": [
                "#!/bin/sh",
                "/usr/bin/python3 configure.py \\",
                "  --bindir=/app/bin \\",
                "  --destdir=/app/lib/python3.5/site-packages \\",
                "  --incdir=/app/include \\",
                "  --pyidir=/app/lib/python3.5/site-packages \\",
                "  --sipdir=/app/share/sip"
              ]
            }
          ],
          "cleanup": [
            "/bin",
            "/include"
          ]
        }
      ]
    },
    {
      "name": "mpv",
      "buildsystem": "simple",
      "build-commands": [
        "python3 waf configure --prefix=/app --disable-libass --disable-build-date --disable-oss-audio --disable-alsa",
        "python3 waf build",
        "python3 waf install"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/mpv-player/mpv/archive/v0.29.0.tar.gz",
          "sha256": "772af878cee5495dcd342788a6d120b90c5b1e677e225c7198f1e76506427319"
        },
        {
          "type": "file",
          "url": "https://waf.io/waf-1.9.8",
          "sha256": "167dc42bab6d5bd823b798af195420319cb5c9b571e00db7d83df2a0fe1f4dbf",
          "dest-filename": "waf"
        }
      ],
      "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/share"
      ],
      "modules": [
        {
          "name": "ffmpeg",
          "config-opts": [
            "--enable-shared",
            "--disable-static",
            "--enable-gnutls",
            "--disable-doc",
            "--disable-programs",
            "--disable-encoders",
            "--disable-muxers",
            "--disable-network",
            "--disable-libxcb",
            "--disable-xlib",
            "--disable-v4l2-m2m",
            "--disable-vaapi",
            "--disable-vdpau",
            "--disable-sdl2",
            "--disable-decoders",
            "--enable-decoder=aac",
            "--enable-decoder=mp3",
            "--enable-decoder=cscd",
            "--disable-hwaccels",
            "--disable-parsers",
            "--enable-parser=aac",
            "--disable-demuxers",
            "--enable-demuxer=aac",
            "--enable-demuxer=mp3",
            "--enable-demuxer=mov",
            "--disable-filters",
            "--disable-bsfs",
            "--disable-indevs",
            "--disable-outdevs",
            "--enable-outdev=alsa",
            "--disable-protocols",
            "--enable-protocol=file"
          ],
          "sources": [
            {
              "type": "archive",
              "url": "https://ffmpeg.org/releases/ffmpeg-4.0.2.tar.xz",
              "sha256": "a95c0cc9eb990e94031d2183f2e6e444cc61c99f6f182d1575c433d62afb2f97"
            }
          ],
          "cleanup": [
            "/include",
            "/lib/pkgconfig",
            "/share/ffmpeg"
          ]
        }
      ]
    },
    {
      "name": "portaudio",
      "config-opts": [
        "--disable-static",
        "--without-oss"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "http://www.portaudio.com/archives/pa_stable_v190600_20161030.tgz",
          "sha256": "f5a21d7dcd6ee84397446fa1fa1a0675bb2e8a4a6dceb4305a8404698d8d1513"
        }
      ],
      "cleanup": [
        "/lib/pkgconfig",
        "/include",
        "*.la"
      ]
    },
    "lame/lame-3.99.5.json",
    "python3-decorator.json",
    "python3-pyaudio.json",
    "python3-bs4.json",
    "python3-requests.json",
    "python3-send2trash.json",
    "python3-markdown.json",
    {
      "name": "anki",
      "no-autogen": true,
      "make-install-args": [
        "PREFIX=/app"
      ],
      "post-install": [
        "install -D -t /app/share/icons/hicolor/scalable/apps anki.svg",
        "install -D -t /app/share/appdata net.ankiweb.Anki.appdata.xml",
        "install -D anki.xml /app/share/mime/packages/net.ankiweb.Anki.xml"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://apps.ankiweb.net/downloads/current/anki-2.1.4-source.tgz",
          "sha256": "666886a36609ec605907da99a8373bc2d0a94704eefb14f60de0d6cf783bb701"
        },
        {
          "type": "patch",
          "path": "python3.5.patch"
        },
        {
          "type": "file",
          "path": "anki.svg"
        },
        {
          "type": "file",
          "path": "net.ankiweb.Anki.appdata.xml"
        },
        {
          "type": "script",
          "commands": [
            "sed -i -e 's/cp -a/cp -dR/' Makefile",
            "sed -i -e 's|/usr/share|/app/share|' anki/lang.py"
          ]
        }
      ],
      "cleanup": [
        "/share/pixmaps"
      ]
    }
  ]
}
